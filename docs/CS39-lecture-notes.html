
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- common.css -->
      <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
      <!-- ace-static.css -->
      <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
      <style>.ace-dawn .ace_gutter {background: #ebebeb;color: #333}.ace-dawn .ace_print-margin {width: 1px;background: #e8e8e8}.ace-dawn {background-color: #F9F9F9;color: #080808}.ace-dawn .ace_cursor {color: #000000}.ace-dawn .ace_marker-layer .ace_selection {background: rgba(39, 95, 255, 0.30)}.ace-dawn.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #F9F9F9;}.ace-dawn .ace_marker-layer .ace_step {background: rgb(255, 255, 0)}.ace-dawn .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgba(75, 75, 126, 0.50)}.ace-dawn .ace_marker-layer .ace_active-line {background: rgba(36, 99, 180, 0.12)}.ace-dawn .ace_gutter-active-line {background-color : #dcdcdc}.ace-dawn .ace_marker-layer .ace_selected-word {border: 1px solid rgba(39, 95, 255, 0.30)}.ace-dawn .ace_invisible {color: rgba(75, 75, 126, 0.50)}.ace-dawn .ace_keyword,.ace-dawn .ace_meta {color: #794938}.ace-dawn .ace_constant,.ace-dawn .ace_constant.ace_character,.ace-dawn .ace_constant.ace_character.ace_escape,.ace-dawn .ace_constant.ace_other {color: #811F24}.ace-dawn .ace_invalid.ace_illegal {text-decoration: underline;font-style: italic;color: #F8F8F8;background-color: #B52A1D}.ace-dawn .ace_invalid.ace_deprecated {text-decoration: underline;font-style: italic;color: #B52A1D}.ace-dawn .ace_support {color: #691C97}.ace-dawn .ace_support.ace_constant {color: #B4371F}.ace-dawn .ace_fold {background-color: #794938;border-color: #080808}.ace-dawn .ace_list,.ace-dawn .ace_markup.ace_list,.ace-dawn .ace_support.ace_function {color: #693A17}.ace-dawn .ace_storage {font-style: italic;color: #A71D5D}.ace-dawn .ace_string {color: #0B6125}.ace-dawn .ace_string.ace_regexp {color: #CF5628}.ace-dawn .ace_comment {font-style: italic;color: #5A525F}.ace-dawn .ace_heading,.ace-dawn .ace_markup.ace_heading {color: #19356D}.ace-dawn .ace_variable {color: #234A97}.ace-dawn .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWNgYGBgYLh/5+x/AAizA4hxNNsZAAAAAElFTkSuQmCC) right repeat-y}</style>
      <!-- export.css -->
      <style>
        body{margin:0 auto;max-width:800px;line-height:1.4}
        #nav{margin:5px 0 10px;font-size:15px}
        #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
        #contentarea{font-size:15px;margin:16px 0}
        .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
        .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
        .latex-cell{white-space:pre-wrap;}
      </style>
      <!-- User CSS -->
      <style> a {font-family: "HelveticaNeue-Light", sans-serif;font-size: 15px;}div.ace_line {}.text-cell {font-size: 15px;font-family: Sans-Serif;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;font-family: Sans-Serif;}.latex-cell {font-size: 15px;font-family: Sans-Serif;}</style>
    </head>
    <body>
      <div id="nav"><div>Next: <a href='CS46-lecture-notes.html'>CS46-lecture-notes</a>, Previous: <a href='CS26-reading-notes.html'>CS26-reading-notes</a>, Up: <a href='index.html'>Index</a></div></div>
      <div id="titlearea">
        <h2>CS39-lecture-notes</h2>
      </div>
      <div id="contentarea"><div class="cell markdown-cell"><h1>CS 39 Lecture notes</h1>
<p>Table of Contents:</p>
<ul>
<li><a href="#aug-21-2018">Aug 21, 2018</a></li>
<li><a href="#aug-23-2018">Aug 23, 2018</a></li>
<li><a href="#aug-28-2018">Aug 28, 2018</a>
<ul>
<li><a href="#mdk-instructions">MDK Instructions</a></li>
</ul>
</li>
<li><a href="#aug-30-2018">Aug 30, 2018</a>
<ul>
<li><a href="#every-line-of-assembly">Every line of assembly</a></li>
</ul>
</li>
<li><a href="#sep-4-2018">Sep 4, 2018</a>
<ul>
<li><a href="#expression-evaluation">Expression evaluation</a></li>
</ul>
</li>
<li><a href="#sep-6-2018">Sep 6, 2018</a></li>
<li><a href="#sep-11-2018">Sep 11, 2018</a>
<ul>
<li><a href="#shifting-bits">Shifting bits</a></li>
</ul>
</li>
<li><a href="#sep-18-2018">Sep 18, 2018</a>
<ul>
<li><a href="#logical-instructions-bitwise">Logical instructions (bitwise)</a></li>
<li><a href="#c-asm">C-&gt;asm</a></li>
</ul>
</li>
<li><a href="#sep-20-2018">Sep 20, 2018</a>
<ul>
<li><a href="#embedded-c-programming">Embedded <code>C</code> Programming</a></li>
</ul>
</li>
<li><a href="#sep-25-2018">Sep 25, 2018</a>
<ul>
<li><a href="#compare">Compare</a></li>
<li><a href="#calculating-the-length-of-a-string">Calculating the length of a String</a></li>
<li><a href="#capitalize-first-letter-of-string">Capitalize first letter of string</a></li>
</ul>
</li>
<li><a href="#sep-27-2018">Sep 27, 2018</a>
<ul>
<li><a href="#memory-review">Memory Review</a></li>
<li><a href="#more-ifelse-patterns">More if..else patterns</a></li>
<li><a href="#mbed-compiler-notes">mbed Compiler Notes</a></li>
<li><a href="#arm-architecture">ARM Architecture</a></li>
</ul>
</li>
<li><a href="#oct-2-2018">Oct 2, 2018</a>
<ul>
<li><a href="#multi-word-arithmetic">Multi-word Arithmetic</a></li>
<li><a href="#twos-complement">Two's Complement</a></li>
<li><a href="#asrs-arithmetic-shift-right"><code>ASRS</code> Arithmetic Shift Right</a></li>
</ul>
</li>
<li><a href="#oct-4-2018">Oct 4, 2018</a>
<ul>
<li><a href="#counting-characters-in-a-string">Counting characters in a string</a></li>
</ul>
</li>
<li><a href="#oct-9-2018">Oct 9, 2018</a>
<ul>
<li><a href="#calculating-arithmetic-mean">Calculating arithmetic mean</a></li>
</ul>
</li>
<li><a href="#oct-11-2018">Oct 11, 2018</a>
<ul>
<li><a href="#10000-foot-view-software-organization">10,000 foot view (software organization)</a></li>
</ul>
</li>
<li><a href="#oct-16-2018">Oct 16, 2018</a>
<ul>
<li><a href="#leds-and-switches">LEDs and Switches</a></li>
</ul>
</li>
<li><a href="#oct-18-2018">Oct 18, 2018</a>
<ul>
<li><a href="#code-conversion">Code conversion</a></li>
</ul>
</li>
<li><a href="#oct-23-2018">Oct 23, 2018</a>
<ul>
<li><a href="#lab-4-32-bit-binary-to-ascii-hex-b32toah">Lab 4: 32-bit Binary to ASCII hex (B32toAH)</a></li>
</ul>
</li>
<li><a href="#oct-25-2018">Oct 25, 2018</a>
<ul>
<li><a href="#more-code-conversion-ascii-decimal---binary">More code conversion: ASCII decimal -&gt; binary</a></li>
</ul>
</li>
<li><a href="#oct-30-2018">Oct 30, 2018</a>
<ul>
<li><a href="#more-code-conversion-binary-to-ascii-binary">More code conversion: Binary to ASCII Binary</a></li>
</ul>
</li>
<li><a href="#nov-1-2018">Nov 1, 2018</a>
<ul>
<li><a href="#lab-5-cipher">Lab 5: Cipher</a></li>
<li><a href="#parameter-passing">Parameter passing</a></li>
</ul>
</li>
<li><a href="#nov-6-2018">Nov 6, 2018</a>
<ul>
<li><a href="#alu">ALU</a></li>
</ul>
</li>
<li><a href="#nov-13-2018">Nov 13, 2018</a>
<ul>
<li><a href="#the-assembler">The Assembler</a></li>
</ul>
</li>
</ul>
<h2>Aug 21, 2018</h2>
<p>Using ARM assembly language</p>
<p>RISC - reduced instructions set computer</p>
<p>ARM is a British company that designs intellectual property, now owned by a japanese company (Softbank).</p>
<p>Last year there was 14 billion ARM chips produced</p>
<p>Software you need:<br>
Keil ARM MDK - software development kit for M-series microcontrollers<br>
<a href="http://www.keil.com">www.keil.com</a><br>
(Windows only)</p>
<p>[X] <s><em>Download Keil tool</em></s> [2018-08-23]</p>
<hr>
<h2>Aug 23, 2018</h2>
<p>A diagram of almost everything</p>
<blockquote>
<p>World -&gt; Sensors<br>
Sensors -&gt; Signal conditioning<br>
Signal conditioning -&gt; Analog to digital<br>
Analog to digital -&gt; cpu<br>
cpu &lt;-&gt; memory<br>
cpu -&gt; output</p>
</blockquote>
<p>Place value = <span class="MathJax" id="MathJax-Element-1449-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23122" style="width: 4.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.448em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.155em, 1000em, 2.378em, -0.484em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-23123"><span class="msubsup" id="MathJax-Span-23124"><span style="display: inline-block; position: relative; width: 4.411em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.716em, -0.484em); top: -2.534em; left: 0em;"><span class="texatom" id="MathJax-Span-23125"><span class="mrow" id="MathJax-Span-23126"><span class="mi" id="MathJax-Span-23127" style="font-family: STIXGeneral-Italic;">b</span><span class="mi" id="MathJax-Span-23128" style="font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-23129" style="font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-23130" style="font-family: STIXGeneral-Italic;">e</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.719em; left: 1.914em;"><span class="texatom" id="MathJax-Span-23131"><span class="mrow" id="MathJax-Span-23132"><span class="mi" id="MathJax-Span-23133" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">p</span><span class="mi" id="MathJax-Span-23134" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-23135" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-23136" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-23137" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mi" id="MathJax-Span-23138" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-23139" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-23140" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.108em; vertical-align: -0.077em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1449">{base}^{position}</script><br>
BYTE = <strong>B</strong>inar<strong>Y TE</strong>rm<br>
BIT = <strong>B</strong>inary dig<strong>IT</strong></p>
<p>A byte is the <strong>smallest addressable unit of space in memory</strong>, typically 8 bits in microcomputers.</p>
<hr>
<h2>Aug 28, 2018</h2>
<p>Read numbers and codes<br>
Take numbers and codes quiz</p>
<p>ASCII (7-bit code, 0-127)<br>
Unicode (16 bit)</p>
<p>CPU Instruction Cycle</p>
<ol>
<li>Fetch instruction</li>
<li>Decode the instruction</li>
<li>Execute</li>
<li>Repeat</li>
</ol>
<p>Inside CPU lives the General Purpose Registers<br>
Program Counter holes the next instruction to fetch</p>
<h3>MDK Instructions</h3>
<p>Put project in new folder<br>
Choose M0 Cortex chip<br>
Choose CMSIS core<br>
and Startup Code</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    AREA |.text|, CODE, READONLY
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EXPORT __main
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>__main
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R0, #1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R4, #3
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R7, R0, R4
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>done    B done
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    END
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<p>A simple program that adds 2 numbers, in this case the numbers 1 and 3 are stored in <code>R0</code> and <code>R4</code>. Then it adds them and puts the result in <code>R7</code>​. To end the program and ensure it doesnt run through memory forever, you add a loop that calls back to itself, in this case <code>done</code>. Note that you must put an enter after the <code>END</code>.</p>
<p>Remember in µVision: Debug using the <strong>simulator</strong> under the magic wand icon.</p>
<hr>
<h2>Aug 30, 2018</h2>
<p>Part number for the chip we’re using - NUCLEO-L432KC</p>
<p>A directive is information for the tool itself. <code>AREA</code> is a directive, it doesn’t produce any machine code technically.</p>
<p>.s files are just text files, not until they are assembled (by a program) is it then turned into a .o file (object code). These .o files are machine code.</p>
<p>The memory map of our chip (32 bit machine) starts at <code>0x00000000</code> and goes to <code>0xFFFFFFFF</code>. In the low memory address is program memory (flash), 32kB. At <code>0x20000000</code>​ RAM begins, 8kB. I/O and peripheral devices are below the RAM, such as timer/counters and USB.</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    AREA |.text|, CODE, READONLY
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EXPORT __main
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>__main
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ;Code goes here
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>done    B done
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    END
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div></div></div></pre>
<p><code>AREA |.text|</code> directive tells the code to go to the .text area. <code>CODE</code> means it is in the code segment of the file. <code>READONLY</code> means it lives in the memory.</p>
<p><code>EXPORT</code>​ gives it an entry point to the label <code>__main</code>. A label is just a point of reference, a named memory location, labels turn into addresses. Labels go into lines that you need to refer to. <code>done</code> is the label of the loop to end it. <code>B</code> means unconditional branch, meaning you always go to this, never skip it. <code>END</code> means there is no more code to assemble, <strong>it always needs a carriage return after</strong>.</p>
<h3>Every line of assembly</h3>
<p><code>​label</code> <em><code>mnemonic</code></em> <em><code>operands</code></em><code>;</code> <em><code>comments</code></em></p>
<ul>
<li>label must be against the left side</li>
<li>mnemonic is our instructions</li>
<li>operands are the parameters of the mnemonic</li>
<li>comments come after the semicolon</li>
</ul>
<table>
<thead>
<tr>
<th>Starting file</th>
<th></th>
<th></th>
<th></th>
<th>ending file</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.s</code></td>
<td>-&gt;</td>
<td>assembler</td>
<td>-&gt;</td>
<td><code>.o</code> (startup files)</td>
</tr>
<tr>
<td><code>.c</code></td>
<td>-&gt;</td>
<td>c compiler</td>
<td>-&gt;</td>
<td><code>.o</code> (startup files)</td>
</tr>
<tr>
<td><code>.s</code></td>
<td>-&gt;</td>
<td>assembler</td>
<td>-&gt;</td>
<td><code>.o</code> (our file)</td>
</tr>
</tbody>
</table>
<p>All of those <code>.o</code> files are then put into a linker, which resolves external references. meaning it looks through all the .o modules and links the references. Generates the <strong>core image</strong> (the actual machine code file that has all the pieces assembled and put together). The core image is then burned into a chip, (or in our case simulated).</p>
<p>Example variables for arithmetic:</p>
<blockquote>
<p>R0 : a<br>
R1 : b<br>
R2 : c<br>
R3 : d<br>
a + b - c + 3</p>
</blockquote>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R0, R0, R1; adds a + b
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    SUBS R0, R0, R2; (a + b) - c
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R0, #3; (a + b - c) + 3
</div></div></div></pre>
<hr>
<h2>Sep 4, 2018</h2>
<h3>Expression evaluation</h3>
<blockquote>
<p>R0 : a<br>
R1 : b<br>
R2 : c<br>
R3 : d</p>
</blockquote>
<p>To multiply a by 2, you can write <code>ADDS R0, R0, R0</code></p>
<blockquote>
<p>a + b + c * 2</p>
</blockquote>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R2, R2, R2; multiply c by 2
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R0, R0, R1; adds a + b
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R0, R0, R2; adds (a + b) + (c * 2)
</div></div></div></pre>
<p>This is a code fragment.</p>
<p>To write this as a complete program with:</p>
<blockquote>
<p>a = 5<br>
b = 2<br>
c = 7</p>
</blockquote>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    AREA |.text|, CODE, READONLY
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EXPORT __main
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>__main
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R0, #5; a
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R1, #2; b
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R2, #7; c
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R2, R2, R2; multiply c by 2
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R0, R0, R1; adds a + b
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R0, R0, R2; adds (a + b) + (c * 2)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R7, =0x20000000; R7 points at the first location in RAM (0x2000 0000)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    STR R0, [R7]; store R0 in the location specified by R7
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R4, [R7]; loads R4 with variable at 0x2000 000 in RAM
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>done    B done
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    END
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div></div></div></pre>
<p>When you run out of registers, you can store variables in RAM (<strong>RAM starts at 20 million hex (<code>0x2000 0000</code>)</strong>). When storing something in RAM it takes 2 clock cycles. The chip we are using only supports indexed addressing. This means you need to specify the address you use to specify the address of the RAM (a pointer). Usually use <code>R6</code> and <code>R7</code>. <code>LDR</code> is used to specify registers in RAM. <code>STR</code> can be used to store it in RAM. To load back into a register you can use <code>LDR</code> also. RAM can only use the <code>LDR</code> and <code>STR</code> instructions, if you need to perform arithmetic on a stored variable, you need to load (<code>LDR</code>) it into register to work on it.</p>
<hr>
<h2>Sep 6, 2018</h2>
<p><code>MOVS</code> moves data and updates the flags. <code>MOV</code> doesn’t update the flags. Instructions with the S update flags.</p>
<p>RAM space:<br>
0x2000 0000 is the beginning of RAM space (32 bits wide)<br>
0x2000 0004 is the next space</p>
<p>32 bits = word<br>
16 bits = half-word<br>
8 bits = byte</p>
<p><code>LDR</code> and <code>STR</code> work with 32 bit numbers. On RISC machines you must use indexed addressing.</p>
<p>To use an offset:<br>
<code>LDR R5, [R7,#4]</code> uses an offset of 4 to point to the address at <code>0x2000 0004</code> (After specifying the address of the first slot in memory with <code>LDR R7,=0x20000000</code>​)</p>
<p>Example of C++ code to turn on and off LED and run a function called <code>myFunc</code>, which is defined in the <code>.s</code> file below</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//#include "mbed.h"</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_modifier">extern</span> <span class="ace_string ace_start">"</span><span class="ace_string">C</span><span class="ace_string ace_end">"</span> <span class="ace_storage ace_type">int</span> <span class="ace_identifier">myFunc</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">a</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">int</span> <span class="ace_identifier">b</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">int</span> <span class="ace_identifier">c</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">//a b and c correspond to registers R0, R1, R2 respectively</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">DigitalOut</span> <span class="ace_identifier">myled</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">LED1</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Serial</span> <span class="ace_identifier">pc</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">USBTX</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">USBRX</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">main</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">pc</span><span class="ace_punctuation ace_operator">.</span><span class="ace_support ace_function ace_C99 ace_c">printf</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">myFunc = </span><span class="ace_constant ace_language ace_escape">%d\n\r</span><span class="ace_string ace_end">"</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">myFunc</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">10</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_constant ace_numeric">5</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">pc</span><span class="ace_punctuation ace_operator">.</span><span class="ace_support ace_function ace_C99 ace_c">printf</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">myFunc = </span><span class="ace_constant ace_language ace_escape">%d\n\r</span><span class="ace_string ace_end">"</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">myFunc</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">2000</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_constant ace_numeric">5000</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_constant ace_numeric">24</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_keyword ace_control">while</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span> <span class="ace_comment">//"Heartbeat", this turns the LED on and off, a good way to see if the program is running</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">myled</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">1</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">//LED is ON</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">wait</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">2.0</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">//Wait 2 sec</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">myled</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">//LED is OFF</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">wait</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">1.0</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">//Wait 1 sec</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></pre>
<p>In another <code>.s</code> file:</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    AREA |.text|, CODE, READONLY
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EXPORT myFunc
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>myFunc
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R0, R0, R1; a + b
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R0, R0, R2; + c
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BX LR; branch exchange with link register (return)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    END
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div></div></div></pre>
<hr>
<h2>Sep 11, 2018</h2>
<h3>Shifting bits</h3>
<p><code>LSLS</code> is a logical shift left. Multiplies by powers of 2. (<span class="MathJax" id="MathJax-Element-1450-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23141" style="width: 1.891em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.689em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.141em, 1000em, 2.365em, -0.478em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-23142"><span class="msubsup" id="MathJax-Span-23143"><span style="display: inline-block; position: relative; width: 1.652em; height: 0px;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.703em, -0.478em); top: -2.534em; left: 0em;"><span class="mn" id="MathJax-Span-23144" style="font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.712em; left: 0.507em;"><span class="texatom" id="MathJax-Span-23145"><span class="mrow" id="MathJax-Span-23146"><span class="mi" id="MathJax-Span-23147" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">b</span><span class="mi" id="MathJax-Span-23148" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-23149" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mi" id="MathJax-Span-23150" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.108em; vertical-align: -0.063em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1450">2 ^ {bits}</script>)<br>
<code>LSRS</code> is a logical shift right. Divides by powers of 2. (<span class="MathJax" id="MathJax-Element-1450-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23141" style="width: 1.891em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.689em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.141em, 1000em, 2.365em, -0.478em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-23142"><span class="msubsup" id="MathJax-Span-23143"><span style="display: inline-block; position: relative; width: 1.652em; height: 0px;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.703em, -0.478em); top: -2.534em; left: 0em;"><span class="mn" id="MathJax-Span-23144" style="font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.712em; left: 0.507em;"><span class="texatom" id="MathJax-Span-23145"><span class="mrow" id="MathJax-Span-23146"><span class="mi" id="MathJax-Span-23147" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">b</span><span class="mi" id="MathJax-Span-23148" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-23149" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mi" id="MathJax-Span-23150" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.108em; vertical-align: -0.063em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1450">2 ^ {bits}</script>)<br>
These commands use a barrel shifter, takes 1 clock cycle. (Takes a lot of hardware real estate though)</p>
<p><code>LSLS</code> 1 bit shift left example:</p>
<blockquote>
<p>0101 = 5 decimal<br>
1010 = 10 decimal. (Basically multiplies the number by 2.)</p>
</blockquote>
<blockquote>
<p>0011 = 3 decimal<br>
0110 = 6 decimal<br>
1100 = 12 decimal</p>
</blockquote>
<p><code>LSLS R0, R0, #2</code> shifts the register <code>R0</code> by 2 to the left, then places the answer back into <code>R0</code>.<br>
The bit that is shifted "off" the number is transferred into the carry bit. This makes the <code>LSLS</code> command really useful to shift numbers into the carry flag. If you wanted to print a binary number to the screen you could individually shift numbers into the carry flag, add 0x30 to it and get the ASCII code for 1 and 0.</p>
<p><code>LSRS</code> 1 bit shift right example:</p>
<blockquote>
<p>1100 = 12 decimal<br>
0110 = 6 decimal</p>
</blockquote>
<blockquote>
<p>0111 = 7 decimal<br>
0011 = 3 decimal (note the 1 that is shifted off goes to the carry bit)</p>
</blockquote>
<p><code>LSRS R3, R1, #4</code> effectively divides <code>R1</code> by 16 (<span class="MathJax" id="MathJax-Element-1451-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23151" style="width: 1.141em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.014em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.146em, 1000em, 2.365em, -0.478em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-23152"><span class="msubsup" id="MathJax-Span-23153"><span style="display: inline-block; position: relative; width: 0.976em; height: 0px;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.703em, -0.478em); top: -2.534em; left: 0em;"><span class="mn" id="MathJax-Span-23154" style="font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.712em; left: 0.507em;"><span class="mn" id="MathJax-Span-23155" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">4</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.103em; vertical-align: -0.063em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1451">2^4</script>) and puts the answer in <code>R3</code></p>
<p>Examples:</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R0,=0x00000007 ; loads R0 with 7
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LSLS R0, R0, #2 ; logical shift left 2 bits, answers 0x0000001C (7 * 4 = 28 = 0x1C)
</div></div></div></pre>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R0,=0xC0000000 ; loads R0 with 0xC0000000
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LSRS R0, R0, #1 ; shifts to the right 1 bit, answers 0x60000000 (half of 0xC = 0x6)
</div></div></div></pre>
<hr>
<h2>Sep 18, 2018</h2>
<h3>Logical instructions (bitwise)</h3>
<p><strong>AND gate:</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">a</th>
<th style="text-align:center">b</th>
<th style="text-align:center">a <code>&amp;&amp;</code> b</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
<p><code>ANDS R0, R1</code> is the biwise AND gate to compare two registers. Can be used to isolate a group or a single bits. Typically used to compare a value with a 'mask' value.</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R0, =0xABCDEFA5; input
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R1, 0xF; mask
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ANDS R0, R1
</div></div></div></pre>
<p>Returns <code>0x00000005</code> in the <code>R0</code> register. <code>ANDS</code> basically clears out all the unwanted bits specified by the register <code>R1</code>. (Remember 0xF is 1111 in binary, so the 5 gets passed through).</p>
<p><strong>OR gate:</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">a</th>
<th style="text-align:center">b</th>
<th style="text-align:center">a <code>||</code> b</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
<p><code>OR</code> turns a bit on if one or the other bit is on.</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R0, =0xABCDEFA5; input
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R1, =0xF0000000; mask
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ANDS R0, R1; and
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R2, #3
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ORRS R0, R2; or
</div></div></div></pre>
<p>Returns <code>0xA0000003</code> in the <code>R0</code> register. Because the A was left in the register because of the <code>ANDS</code> and then turns on the 3 in the last bit because of the <code>ORRS</code>.</p>
<p><strong>To clear a bit <code>ANDS</code> it with 0<br>
To pass a bit <code>ANDS</code> it with a 1<br>
To set a bit <code>ORRS</code> it with a 1</strong></p>
<p><strong>NOT gate:</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">a</th>
<th style="text-align:center"><code>!</code>a</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
</tbody>
</table>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R1, 0xF0000000; mask
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MVNS R3,R1; not the R1 register
</div></div></div></pre>
<p>Returns <code>0x0FFFFFFF</code> into the <code>R3</code> register. <code>MVNS</code> is the NOT operator for this chip (move register and not).</p>
<p><strong>Excluse OR (EOR):</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">a</th>
<th style="text-align:center">b</th>
<th style="text-align:center">a <code>EOR</code> b</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
</tbody>
</table>
<p>One or the other, but not both.</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R0, =0xABCDEFA5
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R1, =0xA5A5A5A5; mask
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EORS R0, R1;
</div></div></div></pre>
<p>Returns <code>0x0E684A00</code>. Everything that matchs gets zeroed out. Running the <code>EORS R0, R1</code> command again will return the register to the original. <strong>This can be used to encrypt.</strong></p>
<h3>C-&gt;asm</h3>
<p>Start using a <code>.c</code> file in microvision.</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_modifier">extern</span> <span class="ace_storage ace_type">int</span> <span class="ace_identifier">myFunc</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">a</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">int</span> <span class="ace_identifier">b</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">int</span> <span class="ace_identifier">c</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">main</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">void</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_storage ace_type">int</span> <span class="ace_identifier">x</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">x</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">myFunc</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">20</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_constant ace_numeric">10</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_constant ace_numeric">5</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<p><code>extern</code> means that the function exists in another block of code. Does need a semicolon after this method header because its connected to the <code>extern</code>. <strong>This file also needs a carriage return after the last curly brace.</strong></p>
<p>In a <code>.s</code> file <strong>(thats named differently then the <code>.c</code> file)</strong></p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    AREA |.text|,CODE,READONLY
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EXPORT myFunc
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>myFunc
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R0, R0, R1; add a + b
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    SUBS R0, R0, R2; subtract c
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BX LR
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    END
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<p><code>BX LR</code> is the return. The variables in the <code>myFunc.c</code> will coorespond to the registers starting at <code>R0</code> onwards (a = <code>R0</code>, b = <code>R1</code>, c = <code>R2</code>).</p>
<hr>
<h2>Sep 20, 2018</h2>
<h3>Embedded <code>C</code> Programming</h3>
<p>History<br>
Developed at Bell Labratories in the 70s. Dennis Ritchie and Ken Thompson developed this language. C was derived from the high-level assembly language B. <strong>Major goal of C was systems programming.</strong> The UNIX operating system was re-written in C. Today C is widespread use with a rich standard library of functions. C is the standard language of microcontrollers, this is because C generates small amounts of code compared to other languages (C++ for example).</p>
<p>Why C?<br>
Flexible language that imposes few constraints on the programmer. Allows low level access to data, operating system, and hardware. Retains the portability and sophisticated syntax of a high-level language. Supports pointers and bitwise operators. Weak type checking (Good or bad?). Designed for modular programming (for example when we had a <code>.s</code> file and a <code>.c</code> file). Extensive use of libraries. The lingua franca of embedded systems programming. Not object-oriented, but can be used with an "object-oriented mindset".</p>
<p>Simplest embedded program</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">main</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword ace_control">while</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></pre>
<p>This compiles sucessfully but doesn't do anything.</p>
<p>Slightly more useful program:</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//#include "mbed.h" (this line breaks the auto-toc)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Serial</span> <span class="ace_identifier">pc</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">USBTX</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">USBRX</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">//a little c++</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">main</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">pc</span><span class="ace_punctuation ace_operator">.</span><span class="ace_support ace_function ace_C99 ace_c">printf</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">Hello world</span><span class="ace_constant ace_language ace_escape">\n\r</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword ace_control">while</span> <span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">//infinite loop</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></pre>
<p>Some key elements of a C program:<br>
<code>;</code></p>
<ul>
<li>The semicolon is a statement terminator (just like in Java)</li>
<li>The simplest expression is a semicolon alone.</li>
</ul>
<p><code>{}</code></p>
<ul>
<li>Curly braces delineate the beginning and end of a function</li>
<li>Curly braces also group statements so they are treated as one block</li>
</ul>
<p><code>"text"</code></p>
<ul>
<li>A string is delineated with double quotes</li>
</ul>
<p>comments</p>
<ul>
<li><code>//</code> or <code>/* */</code> are comment delimiters</li>
</ul>
<p>Identifiers in C:</p>
<ul>
<li>An identifier is a name of something in your prograrm
<ul>
<li>a function, variable, constant</li>
</ul>
</li>
<li>Identifiers begin with a letter or underscore (_)
<ul>
<li>Followed by a sequence of letters, digits, or underscores</li>
<li>Its not good practice to start a identifier with an underscore, because it is reserved identifiers generated by the compiler</li>
</ul>
</li>
<li>Identifiers are case sensitive</li>
<li>Identifiers can be any length, <em>but</em>
<ul>
<li>some compilers recognize only a limited number of characters (usually 32 characters). This means if 2 identifiers use the same name up to 32 characters they will be treated as the same identifier, even if the characters after are different.</li>
</ul>
</li>
<li>Reserved words cannot be used as identifiers
<ul>
<li>What are some reserved words in C?</li>
<li>i.e. <code>auto</code>, <code>break</code>, <code>case</code>, <code>char</code>, <code>continue</code>, <code>default</code>, <code>extern</code></li>
</ul>
</li>
</ul>
<p>Variables:<br>
Variables represent a value that can be changed. Variables are declared by indicating the type followed by an identifier.</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">dogs</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">cats</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">unsigned</span> <span class="ace_storage ace_type">char</span> <span class="ace_identifier">portInput</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">float</span> <span class="ace_identifier">price</span><span class="ace_punctuation ace_operator">;</span>
</div></div></div></pre>
<p>Variables are stored in the relatively small RAM of the microcontroller. The programmer must declare the type, and therefore the size of each variable.</p>
<p>Variable scope:<br>
The scope of a variable is its accessibility within the program.</p>
<ul>
<li>Local Variables
<ul>
<li>Declared within a function</li>
<li>Memory space is allocated when a function is entered</li>
<li>Generally, memory space is released when function exits (returns)</li>
<li>Can only be accessed from within the function they are declared</li>
<li>You can use the same local variable declarations in multiple functions since the compiler sees the local in functions independently</li>
</ul>
</li>
<li>Global variables
<ul>
<li>Can be accessed by all the functions in a program (unlimited scope)</li>
<li>Global variables can be modified by any function and will retain their value as long as the program is under execution</li>
</ul>
</li>
</ul>
<p>Constants:</p>
<ul>
<li>Constants are fixed values</li>
<li>In microcontroller programs, constants are usually stored in read-only memory
<ul>
<li>This saves RAM for variables</li>
</ul>
</li>
<li>Consider this assignment
<ul>
<li><code>z = rho + 5;</code></li>
<li>the five is a numeric constant and becomes part of the code that performs the addition.</li>
</ul>
</li>
<li>You can declare a named constant as follows:
<ul>
<li><code>const</code> <em><code>type</code></em> <em><code>identifier</code></em> <code>=</code> <em><code>expression</code></em><code>;</code></li>
<li>i.e. <code>const int myIntConstant = 25;</code></li>
</ul>
</li>
<li>Numeric constants can be declared with base or type</li>
<li>Decimal is the default base
<ul>
<li><code>1695</code></li>
</ul>
</li>
<li>Binary constants begin with <code>0b</code> prefix
<ul>
<li><code>0b01000001</code></li>
</ul>
</li>
<li>Hexadecimal prefixed with <code>0x</code>
<ul>
<li><code>0x1234ABCD</code></li>
</ul>
</li>
<li>You can specify the type of a numeric constant with a suffix
<ul>
<li><code>4000U</code>, U is for unsigned</li>
<li><code>15.1F</code>, F is for float</li>
</ul>
</li>
<li>Character constants are enclosed in single quotes
<ul>
<li><code>'M'</code></li>
</ul>
</li>
</ul>
<p>Operators and expressions:</p>
<ul>
<li>Variables are assigned using the <code>=</code></li>
<li>A numeric expressions can be on the right side of the assignment operator</li>
</ul>
<hr>
<h2>Sep 25, 2018</h2>
<h3>Compare</h3>
<p><code>CMP</code> is the instruction that compares registers. <code>CMP R0, #5</code> compares register <code>R0</code> to the immediate 8 bit number <code>5</code>. It subtracts the register with the number, if the zero flag is turned on then it means that the comparison is "true", "set", or "logic level one". This is often used in conjunction with the branch conditional instruction, <code>Bcc</code> (pg. 34).</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    CMP R0, #5; checks if R0 is 5
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BEQ doStuff; BEQ means branch if equal, checks if the zero flag is 1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ;code to skip here
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>doStuff
</div></div></div></pre>
<p><strong><code>Bcc</code> Conditional Branch</strong></p>
<table>
<thead>
<tr>
<th>Specific Flag Tests</th>
<th>Meaning</th>
<th>Flags affected</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BEQ</code></td>
<td>Branch if equal</td>
<td><code>z == 1</code></td>
</tr>
<tr>
<td><code>BNE</code></td>
<td>Branch if not equal</td>
<td><code>z == 0</code></td>
</tr>
<tr>
<td><code>BCS</code></td>
<td>Branch if carry is set</td>
<td><code>c == 1</code></td>
</tr>
<tr>
<td><code>BCC</code></td>
<td>Branch if carry is clear</td>
<td><code>c == 0</code></td>
</tr>
<tr>
<td><code>BMI</code></td>
<td>Branch if minus, negative</td>
<td><code>n == 1</code></td>
</tr>
<tr>
<td><code>BPL</code></td>
<td>Branch if plus, positive</td>
<td><code>n == 0</code></td>
</tr>
<tr>
<td><code>BVS</code></td>
<td>Branch if overflow</td>
<td><code>v == 1</code></td>
</tr>
<tr>
<td><code>BVC</code></td>
<td>Branch if no overflow</td>
<td><code>v == 0</code></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Unsigned/signed tests</th>
<th>Meaning</th>
<th>Flags affected</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BEQ</code></td>
<td>Branch if equal</td>
<td><code>z == 1</code></td>
</tr>
<tr>
<td><code>BNE</code></td>
<td>Branch if not equal</td>
<td><code>z == 0</code></td>
</tr>
<tr>
<td><code>BHI</code></td>
<td>Branch if higher</td>
<td><code>c == 1</code>, <code>z == 1</code></td>
</tr>
<tr>
<td><code>BLO</code></td>
<td>Branch if lower</td>
<td><code>c == 0</code></td>
</tr>
<tr>
<td><code>BHS</code></td>
<td>Branch if higher or the same</td>
<td><code>c == 1</code></td>
</tr>
<tr>
<td><code>BLS</code></td>
<td>Branch if lower or same</td>
<td><code>c == 0</code>, <code>z == 1</code></td>
</tr>
</tbody>
</table>
<p><strong>if statement:</strong><br>
For example to translate:</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">if</span> (<span class="ace_identifier">a</span> <span class="ace_keyword ace_operator">==</span> <span class="ace_constant ace_numeric">5</span>)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">a</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">b</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_constant ace_numeric">2</span>;
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>}
</div></div></div></pre>
<p>In assembly:</p>
<blockquote>
<p>a = <code>R0</code><br>
b = <code>R1</code></p>
</blockquote>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    CMP R0 #5; compares a to 5
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BNE endif1; branch if not equal, checks if zero flag is 0
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R1, R0; move b into a
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R0, #2; b + 2
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>endif1
</div></div></div></pre>
<p>Look at the relationship of the high level language and <strong>make the opposite of the comparison</strong>.</p>
<p><strong>if..else:</strong><br>
Example:</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">if</span> (<span class="ace_identifier">a</span> <span class="ace_keyword ace_operator">!=</span> <span class="ace_identifier">b</span>)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">a</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">5</span>;
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>}
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">else</span> <span class="ace_comment">//a == b</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">a</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">1</span>;
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>}
</div></div></div></pre>
<p>In assembly:</p>
<blockquote>
<p>a = <code>R0</code><br>
b = <code>R1</code></p>
</blockquote>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    CMP R0, R1; a != b ?
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BEQ else1; branch if equal, checks if zero flag is 1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R0, #5; a = 5
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    B endif1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>else1   
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R0, #1; a = 1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>endif1
</div></div></div></pre>
<p><strong>Example with greater than:</strong></p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">if</span> (<span class="ace_identifier">a</span> <span class="ace_keyword ace_operator">&gt;</span> <span class="ace_constant ace_numeric">5</span>)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">b</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">a</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_constant ace_numeric">2</span>;
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>}
</div></div></div></pre>
<p>In assembly:</p>
<blockquote>
<p>a = <code>R0</code><br>
b = <code>R1</code></p>
</blockquote>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    CMP R0 #5;
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BLS endif1; branch if lower or equal, checks if carry flag is 0 and zero flag is 1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R1, R0
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R1, R1, #2
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>endif1
</div></div></div></pre>
<p><strong>One more if..else:</strong></p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">if</span> (<span class="ace_identifier">a</span> <span class="ace_keyword ace_operator">&gt;=</span> <span class="ace_identifier">b</span>)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">a</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span>;
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>}
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">else</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">a</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">42</span>;
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>}
</div></div></div></pre>
<p>In assembly:</p>
<blockquote>
<p>a = <code>R0</code><br>
b = <code>R1</code></p>
</blockquote>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    CMP R0, R1; a &gt;= b
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BLO else1; branch if lower, (opposite of &gt;=), checks if the carry flag is 0
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R0, #0
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    B endif1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>else1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R0, #42
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>endif1
</div></div></div></pre>
<p><strong>While loop:</strong></p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">count</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span>;
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">while</span> (<span class="ace_identifier">count</span> <span class="ace_keyword ace_operator">&lt;</span> <span class="ace_constant ace_numeric">5</span>)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">count</span><span class="ace_keyword ace_operator">++</span>;
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>}
</div></div></div></pre>
<p>In assembly:</p>
<blockquote>
<p>count = <code>R4</code></p>
</blockquote>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R4, #0; initilize count
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>while1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    CMP R4, #5; compare R4 to 5
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BHS endwhile; unsigned higher or same, checks if carry flag is 1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R4, #1; increment count
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    B while1; B alone is unconditional branch
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>endwhile
</div></div></div></pre>
<h3>Calculating the length of a String</h3>
<p>In the first document <code>LE3C.c</code>, write a function called <code>slen(char s[])</code> that takes a char array (String) as the parameter, (slen is short for string length). Also initialize the char array (String), <code>myString[]</code> and the int <code>x</code>. Then in the <code>main()</code> method set the variable <code>x</code> to the length of the string <code>myString</code>. Both variables are stored in memory because they are global.</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_modifier">extern</span> <span class="ace_storage ace_type">int</span> <span class="ace_identifier">slen</span><span class="ace_paren ace_lparen">(</span> <span class="ace_storage ace_type">char</span> <span class="ace_identifier">s</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">]</span> <span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">x</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">char</span> <span class="ace_identifier">myString</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">]</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string ace_start">"</span><span class="ace_string">anything you want.</span><span class="ace_string ace_end">"</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">main</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">x</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">slen</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">myString</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></pre>
<p>Then in our <code>LE3asm.s</code> file, we write the assembly to do this:</p>
<blockquote>
<p><code>R0</code> is location in memory of <code>myString</code><br>
<code>R1</code> is char counter<br>
<code>R2</code> is current character</p>
</blockquote>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    AREA |.text|, CODE, READONLY
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EXPORT slen
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>slen
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R1, #0; char counter = 0
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>while1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDRB R2, [R0]; current character pointer
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    CMP R2, #0; compare for null terminator
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BEQ endWhile
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    ADDS R1,#1; increment counter
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    ADDS R0,#1; advance pointer
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    B while1    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>endWhile    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOV R0,R1; put char count in return register
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BX LR; return
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    END
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<p>The commands after the  <code>BEQ</code> check don't need to be indented (and wouldn't normally), but it helps to better visualize what is inside the loop.</p>
<h3>Capitalize first letter of string</h3>
<p>Add to our <code>LE3C.c</code> file add a <code>firstToUpper(char s[])</code> method that takes an array of chars (String) as parameter. Note we call that method before our <code>slen</code> method in the <code>main()</code>.</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_modifier">extern</span> <span class="ace_storage ace_type">int</span> <span class="ace_identifier">slen</span><span class="ace_paren ace_lparen">(</span> <span class="ace_storage ace_type">char</span> <span class="ace_identifier">s</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">]</span> <span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_modifier">extern</span> <span class="ace_storage ace_type">void</span> <span class="ace_identifier">firstToUpper</span><span class="ace_paren ace_lparen">(</span> <span class="ace_storage ace_type">char</span> <span class="ace_identifier">s</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">]</span> <span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">x</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">char</span> <span class="ace_identifier">myString</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">]</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string ace_start">"</span><span class="ace_string">anything you want.</span><span class="ace_string ace_end">"</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">main</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">firstToUpper</span><span class="ace_paren ace_lparen">(</span> <span class="ace_identifier">myString</span> <span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">x</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">slen</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">myString</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<p>In <code>LE3asm.s</code> file, we must add another <code>EXPORT</code> at the top with our new function <code>firstToUpper</code>. Adding <code>firstToUpper</code> label down below the other code is perfectly legal. It must be added after the return (<code>BX LR</code>) of the <code>slen</code> function though. <code>firstToUpper</code> also needs it own new return (<code>BX LR</code>). Only one <code>END</code> with a carriage return is needed.</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    AREA |.text|, CODE, READONLY
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EXPORT slen
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EXPORT firstToUpper
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>slen
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R1, #0; char counter = 0
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>while1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDRB R2, [R0]; current character pointer
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    CMP R2, #0; compare for null terminator
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BEQ endWhile
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    ADDS R1,#1; increment counter
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    ADDS R0,#1; advance pointer
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    B while1    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>endWhile    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOV R0,R1; put char count in return register
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BX LR; return
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>;---------------------------------------------------
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>firstToUpper
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDRB R1, [R0]; load first character from string into R1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R2, #0xDF; mask to clear bit 5
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ANDS R1, R2; clear bit 5
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    STRB R1, [R0]; put char back in string
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BX LR; return
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    END
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<p><code>firstToUpper</code> starts by loading the first char (byte) into <code>R1</code> using the <code>LDRB</code> (load byte). We <code>MOVS</code> the hexadecimal number <code>0xDF</code> into <code>R2</code> to be used as a mask. This mask is <code>1101 1111</code> in binary. This allows us to use the <code>ANDS</code> with the mask to minus 32 bit (the 0) from the number (changing it from the ASCII code of the lowercase letter to the ASCII code of the uppercase, 97 - 65 = 32). Finally the result is stored using the <code>STRB</code> (store byte) command back into where <code>R0</code> is pointing (the first letter of <code>myString</code>).</p>
<table>
<thead>
<tr>
<th>Decimal</th>
<th>Hexadecimal</th>
<th>Binary</th>
<th>ASCII</th>
</tr>
</thead>
<tbody>
<tr>
<td>97</td>
<td>0x61</td>
<td>0b0110 0001</td>
<td>a</td>
</tr>
<tr>
<td>65</td>
<td>0x41</td>
<td>0b0100 0001</td>
<td>A</td>
</tr>
</tbody>
</table>
<blockquote>
<p><code>0b01</code><strong><code>1</code></strong><code>0 0001</code> (<code>0x61</code>)<br>
<code>0b11</code><strong><code>0</code></strong><code>1 1111</code> (<code>0xDF</code> mask)<br>
AND<br>
<code>0b01</code><strong><code>0</code></strong><code>0 0001</code> (<code>0x41</code>)</p>
</blockquote>
<hr>
<h2>Sep 27, 2018</h2>
<p>Video lecture notes</p>
<h3>Memory Review</h3>
<p>Loading a variable from RAM into a General Purpose Register</p>
<ol>
<li>Point at the memory location of the variable</li>
<li>Load the ariable from the pointer register location</li>
</ol>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>LDR R7, =0x20000000; address of variable
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>LDR R0, [R7]; copy data addressed by R7 to R0
</div></div></div></pre>
<p>Storing a variable into RAM from a General Purpose Register</p>
<ol>
<li>Point at the memory location of the variable</li>
<li>Store the register value at the pointer register location</li>
</ol>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>LDR R7, =0x20000000; address of variable
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>STR R0, [R7]; copy value in R0 to location addressed by [R7]
</div></div></div></pre>
<h3>More if..else patterns</h3>
<p>if pattern:</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">if</span> (<span class="ace_identifier">a</span> <span class="ace_keyword ace_operator">==</span> <span class="ace_constant ace_numeric">5</span>)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">b</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">9</span>;
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>}
</div></div></div></pre>
<p>In assembly:</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    CMP R0, #5; a == 5?
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BNE endif1; if a != 5 then branch
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R7 =b; R7 points at b variable in memory (=b is a placeholder for the address of b variable)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R1, #9;
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    STR R1, [R7]
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>endif1
</div></div></div></pre>
<p>if..else pattern:</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">if</span> (<span class="ace_identifier">a</span> <span class="ace_keyword ace_operator">==</span> <span class="ace_constant ace_numeric">5</span>)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">b</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">9</span>;
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>}
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">else</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">b</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">7</span>;
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>}
</div></div></div></pre>
<p>In assembly:</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    CMP R0, #5; a == 5?
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BNE else1; if a != 5 then skip if part
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R7, =b; R7 points at b variable in memory (=b is a placeholder for the address of b variable)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R1, #9; data to store in R1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    STR R1, [R7]
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    B endif; skip the else
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>else1   
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R7, =b
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R1, #7
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    STR R1, [R7]
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>endif
</div></div></div></pre>
<p>Remember: <strong>use the branch that is opposite the high-level operator</strong></p>
<p>Summary:</p>
<ul>
<li>Load variable before doing comparison</li>
<li>Use the branch opposite of the relational operator after the comparison
<ul>
<li>This will skip the block if the Boolean expression is false</li>
</ul>
</li>
<li>Place an unconditional branch at the bottom of the if-true block in order to skip the else
<ul>
<li>The if-block and else-block are mutually exclusive</li>
</ul>
</li>
</ul>
<h3>mbed Compiler Notes</h3>
<ul>
<li>Typically, no need to load variables before doing comparison
<ul>
<li>mbed compiler passes the first four parameters in <code>R0</code>-<code>R3</code></li>
<li>The compiler will load the variables before calling your subprogram</li>
</ul>
</li>
<li>In the following function definition, <code>a</code> is passed in <code>R0</code>, <code>b</code> is passed in <code>R1</code> and so on...<br>
<code>extern "C" int my_asm(int a, int b, int c);</code><br>
When you call the function in your C code as follows:<br>
<code>my_asm(25, x, y + 2);</code><br>
The compiler will load <code>R0</code> with 25, <code>R1</code> with the value of the variable <code>x</code>, which was declared in the C code, and <code>R2</code> with the value of the C declared variable <code>y</code> plus 2.</li>
</ul>
<p>The compiler generates code something like this:</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R0, #25; first parameter into R0
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R7, =x; R7 now points at the address of the x variable (the compiler handles this for you)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R1, [R7]; second parameter, x, into R1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R7, =y; address of y into R7
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R2, [R7]; third parameter y into R2
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R2, #2; add 2 to y
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BL my_asm; call your function
</div></div></div></pre>
<p>(<code>=x</code> and <code>=y</code> are placedholders for where it is in memory for the sake of these notes)</p>
<h3>ARM Architecture</h3>
<p>Data sizes and instruction sets</p>
<ul>
<li>ARM is a RISC architecture
<ul>
<li>Most instructions execute in a single cycle, orthogonal register set, load-store architecture</li>
</ul>
</li>
<li>ARM is a 32-bit load-store architecture
<ul>
<li>The only memory accesses allowed are loads and stores (<code>LDR</code> and <code>STR</code>)</li>
<li>Most internal registers are 32-bits wide</li>
</ul>
</li>
<li>When used in relation to the ARM
<ul>
<li><em>Word</em> means 32 bits (four bytes)</li>
<li><em>Halfword</em> means 16 bits (two  bytes)</li>
<li><em>Doubleword</em> means 64 bits (eight bytes)</li>
</ul>
</li>
<li>Most ARM cores implement two instruction sets
<ul>
<li>32-bit ARM Instruction Set</li>
<li>16/32-bit Thumb Instruction Set</li>
</ul>
</li>
<li>Older cores support 16-bit Thumb Instructions only
<ul>
<li>Thumb-2 technology in current cores adds 32-bit instructions</li>
<li>Maintains code density with increased flexibility</li>
</ul>
</li>
</ul>
<p>Processor Modes</p>
<ul>
<li>Most ARM cores have seven basic operating modes
<ul>
<li>Each mode has access to its own stack space and a different subset of registers</li>
<li>Some operations can only be carried out in a privileged mode</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Description</th>
<th>Privileged</th>
</tr>
</thead>
<tbody>
<tr>
<td>Supervisor (SVC)</td>
<td>Entered on reset and when a Supervisor call instruction (SVC) is executed</td>
<td>Yes</td>
</tr>
<tr>
<td>FIQ</td>
<td>Entered when a high priority (fast) interrupt is raised</td>
<td>Yes</td>
</tr>
<tr>
<td>IRQ</td>
<td>Entered when a normal priority interrupt is raised</td>
<td>Yes</td>
</tr>
<tr>
<td>Abort</td>
<td>Used to handle memory access violations</td>
<td>Yes</td>
</tr>
<tr>
<td>Undef</td>
<td>Used to handle undefined instructions</td>
<td>Yes</td>
</tr>
<tr>
<td>System</td>
<td>Privileged mode using the same registers as User mode</td>
<td>Yes</td>
</tr>
<tr>
<td>User</td>
<td>Mode under which most Applications/OS tasks run</td>
<td>No</td>
</tr>
</tbody>
</table>
<p>(These are modes for ARM A and ARM R chips, ARM M chips have 2 modes: User and Handler)</p>
<p>In ARM M chips:</p>
<ul>
<li>13 General purpose registers
<ul>
<li>Registers <code>R0</code> - <code>R7</code> (low registers)</li>
<li>Registers <code>R8</code> - <code>R12</code> (high registers)</li>
</ul>
</li>
<li>3 Registers with special meaning/usage
<ul>
<li>Stack Pointer (SP) - <code>R13</code></li>
<li>Link Register (LR) - <code>R14</code></li>
<li>Program Counter (PC) - <code>R15</code></li>
</ul>
</li>
<li>Special-purpose registers
<ul>
<li>xPSR is the program status register
<ul>
<li>Conditional code flags
<ul>
<li>N = Negative result flag (negative result from ALU)</li>
<li>Z = Zero result flag (zero result from ALU)</li>
<li>C = Carry flag (ALU operation carried out)</li>
<li>V = Overflow flag (ALU operation overflowed)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>ARM Instruction Set</p>
<ul>
<li>All instructions are 32 bits long</li>
<li>Most instructions can be conditionally executed</li>
<li>Load/Store instruction set - no direction manipulation of memory contents</li>
</ul>
<hr>
<h2>Oct 2, 2018</h2>
<ul class="task-list">
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox"> <s><em>Midterm on Oct 16</em></s> [2018-10-16]</li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox"> <s><em>Make midterm notes</em></s> [2018-10-16]<br>
(Ch. 1 - 5 LCARpi, number conversions, covers instructions we've used, and can use booklet and one 8.5x11 piece of paper for notes)</li>
</ul>
<h3>Multi-word Arithmetic</h3>
<p>Our registers are 32 bits long. The right most position is position 0 and the leftmost is position 31.</p>
<p>Example:</p>
<blockquote>
<p><code>R4</code> = <code>1111 1111 1111 1111 1111 1111 1111 1111</code></p>
</blockquote>
<p>Adding 1 to this register will clear all the 1s into 0s and turn on the carry flag and the zero flag (effectively loosing the number).</p>
<p>To add larger numbers then  our register size (<span class="MathJax" id="MathJax-Element-1452-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23156" style="width: 1.516em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.351em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.146em, 1000em, 2.365em, -0.478em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-23157"><span class="msubsup" id="MathJax-Span-23158"><span style="display: inline-block; position: relative; width: 1.314em; height: 0px;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.703em, -0.478em); top: -2.534em; left: 0em;"><span class="mn" id="MathJax-Span-23159" style="font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.712em; left: 0.507em;"><span class="texatom" id="MathJax-Span-23160"><span class="mrow" id="MathJax-Span-23161"><span class="mn" id="MathJax-Span-23162" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">32</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.103em; vertical-align: -0.063em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1452">2^{32}</script> (32 bits)) you will need to use 2 registers at a time, one to specify the lower word and one the higher word.</p>
<p>To demonstrate this:</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R4, =0xFFFFFFFF
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R4, #1
</div></div></div></pre>
<p>This clears <code>R4</code> and turns on the carry and the zero flags.</p>
<p>To successfully add numbers bigger then 32 bits you must specify a register as the low word and another as the high word. This is a symbolic specification, the registers don't actually get joined, just arithmetic on them can be performed on them individually and thought of them as being joined.</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R4, =0xFFFFFFFF; low word 64 bit first var
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R5, #1; high word 64 bit first var
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R6, #1; low word 64 bit second var
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R7, #0; high word of 64 bit second var
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R6, R4, R6; add low words
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADCS R7, R5; add high words and potential carry
</div></div></div></pre>
<p><code>ADCS</code> is add with carry, takes 2 registers and the carry flag into consideration. To add the first and the second 64-bit variables you must add the low words (with <code>ADDS</code>) then the high words (with <code>ADCS</code>).</p>
<h3>Two's Complement</h3>
<blockquote>
<p><span class="MathJax" id="MathJax-Element-1453-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23163" style="width: 8.641em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.77em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.479em, 1000em, 2.714em, -0.478em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-23164"><span class="msubsup" id="MathJax-Span-23165"><span style="display: inline-block; position: relative; width: 3.059em; height: 0px;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.703em, -0.478em); top: -2.534em; left: 0em;"><span class="mn" id="MathJax-Span-23166" style="font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.712em; left: 0.507em;"><span class="texatom" id="MathJax-Span-23167"><span class="mrow" id="MathJax-Span-23168"><span class="mo" id="MathJax-Span-23169" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-23170" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">b</span><span class="mi" id="MathJax-Span-23171" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-23172" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mi" id="MathJax-Span-23173" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span class="mo" id="MathJax-Span-23174" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">−</span><span class="mn" id="MathJax-Span-23175" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-23176" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-23177" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mn" id="MathJax-Span-23178" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">1</span><span class="mo" id="MathJax-Span-23179" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-23180" style="font-family: STIXGeneral-Italic; padding-left: 0.313em;">m</span><span class="mi" id="MathJax-Span-23181" style="font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-23182" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.121em; vertical-align: -0.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1453">2 ^ {(bits - 1)} - 1 = max</script><br>
<span class="MathJax" id="MathJax-Element-1454-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23183" style="width: 7.391em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.644em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.479em, 1000em, 2.714em, -0.443em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-23184"><span class="mo" id="MathJax-Span-23185" style="font-family: STIXGeneral-Regular;">−</span><span class="msubsup" id="MathJax-Span-23186"><span style="display: inline-block; position: relative; width: 3.059em; height: 0px;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.703em, -0.478em); top: -2.534em; left: 0em;"><span class="mn" id="MathJax-Span-23187" style="font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.712em; left: 0.507em;"><span class="texatom" id="MathJax-Span-23188"><span class="mrow" id="MathJax-Span-23189"><span class="mo" id="MathJax-Span-23190" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-23191" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">b</span><span class="mi" id="MathJax-Span-23192" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-23193" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mi" id="MathJax-Span-23194" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span class="mo" id="MathJax-Span-23195" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">−</span><span class="mn" id="MathJax-Span-23196" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-23197" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-23198" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-23199" style="font-family: STIXGeneral-Italic; padding-left: 0.313em;">m</span><span class="mi" id="MathJax-Span-23200" style="font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-23201" style="font-family: STIXGeneral-Italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.121em; vertical-align: -0.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1454">-2 ^ {(bits - 1)} = min</script></p>
</blockquote>
<p>For example in 8 bits:</p>
<blockquote>
<p><span class="MathJax" id="MathJax-Element-1455-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23202" style="width: 10.266em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.234em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.484em, 1000em, 2.88em, -0.478em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-23203"><span class="msubsup" id="MathJax-Span-23204"><span style="display: inline-block; position: relative; width: 2.327em; height: 0px;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.703em, -0.478em); top: -2.534em; left: 0em;"><span class="mn" id="MathJax-Span-23205" style="font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.712em; left: 0.507em;"><span class="texatom" id="MathJax-Span-23206"><span class="mrow" id="MathJax-Span-23207"><span class="mo" id="MathJax-Span-23208" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mn" id="MathJax-Span-23209" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">8</span><span class="mo" id="MathJax-Span-23210" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">−</span><span class="mn" id="MathJax-Span-23211" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-23212" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-23213" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mn" id="MathJax-Span-23214" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">1</span><span class="mo" id="MathJax-Span-23215" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-23216" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">127</span><span class="mo" id="MathJax-Span-23217" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-23218" style="font-family: STIXGeneral-Italic;">m</span><span class="mi" id="MathJax-Span-23219" style="font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-23220" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23221" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.299em; vertical-align: -0.259em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1455">2^{(8 - 1)} - 1 =  127 (max)</script><br>
<span class="MathJax" id="MathJax-Element-1456-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23222" style="width: 9.766em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.784em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.484em, 1000em, 2.88em, -0.443em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-23223"><span class="mo" id="MathJax-Span-23224" style="font-family: STIXGeneral-Regular;">−</span><span class="msubsup" id="MathJax-Span-23225"><span style="display: inline-block; position: relative; width: 2.327em; height: 0px;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.703em, -0.478em); top: -2.534em; left: 0em;"><span class="mn" id="MathJax-Span-23226" style="font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.712em; left: 0.507em;"><span class="texatom" id="MathJax-Span-23227"><span class="mrow" id="MathJax-Span-23228"><span class="mo" id="MathJax-Span-23229" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mn" id="MathJax-Span-23230" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">8</span><span class="mo" id="MathJax-Span-23231" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">−</span><span class="mn" id="MathJax-Span-23232" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-23233" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-23234" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mo" id="MathJax-Span-23235" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">−</span><span class="mn" id="MathJax-Span-23236" style="font-family: STIXGeneral-Regular;">128</span><span class="mo" id="MathJax-Span-23237" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-23238" style="font-family: STIXGeneral-Italic;">m</span><span class="mi" id="MathJax-Span-23239" style="font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-23240" style="font-family: STIXGeneral-Italic;">n</span><span class="mo" id="MathJax-Span-23241" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.299em; vertical-align: -0.259em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1456">-2^{(8 - 1)} = -128 (min)</script></p>
</blockquote>
<p>(The reason you minus one from the max is to compensate for zero)</p>
<p>To go from positive to negative (for example in a byte) <strong>invert the bits and add 1</strong><br>
For example with the decimal number 5:</p>
<blockquote>
<p><span class="MathJax" id="MathJax-Element-1457-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23242" style="width: 5.203em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.673em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.677em, 1000em, 2.863em, -0.483em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-23243"><span class="mn" id="MathJax-Span-23244" style="font-family: STIXGeneral-Regular;">0101</span><span class="mo" id="MathJax-Span-23245" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-23246" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 1.314em; height: 0px;"><span style="position: absolute; clip: rect(1.677em, 1000em, 2.717em, -0.476em); top: -2.534em; left: 0em;"><span class="mn" id="MathJax-Span-23247" style="font-family: STIXGeneral-Regular;">5</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.507em;"><span class="texatom" id="MathJax-Span-23248"><span class="mrow" id="MathJax-Span-23249"><span class="mn" id="MathJax-Span-23250" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">10</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.066em; vertical-align: -0.24em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1457">0101 = 5_{10}</script><br>
<span class="MathJax" id="MathJax-Element-1458-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23251" style="width: 11.578em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.417em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.677em, 1000em, 2.863em, -0.396em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-23252"><span class="mn" id="MathJax-Span-23253" style="font-family: STIXGeneral-Regular;">1010</span><span class="mo" id="MathJax-Span-23254" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="mn" id="MathJax-Span-23255" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">1</span><span class="mo" id="MathJax-Span-23256" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-23257" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">1011</span><span class="mo" id="MathJax-Span-23258" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mo" id="MathJax-Span-23259" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">−</span><span class="msubsup" id="MathJax-Span-23260"><span style="display: inline-block; position: relative; width: 1.314em; height: 0px;"><span style="position: absolute; clip: rect(1.677em, 1000em, 2.717em, -0.476em); top: -2.534em; left: 0em;"><span class="mn" id="MathJax-Span-23261" style="font-family: STIXGeneral-Regular;">5</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.507em;"><span class="texatom" id="MathJax-Span-23262"><span class="mrow" id="MathJax-Span-23263"><span class="mn" id="MathJax-Span-23264" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">10</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.066em; vertical-align: -0.24em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1458">1010 + 1 = 1011 = -5_{10}</script></p>
</blockquote>
<p><code>SXTB</code> instruction:</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R7, =0x2000000F; load R7 with first address of RAM
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDRB R0, [R7]; loads byte into R0
</div></div></div></pre>
<p>This returns all 1s in the low byte but 0s in the rest of the register. This means that the signed number (-1) isn't preserved. You must use a <code>SXTB</code> (sign extend) instruction which extends an 8 bit value to 32 bits and writes the result to the same register. Continuing from the above example, to preserve the signed number (-1):</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    SXTB R0, R0; sign extend
</div></div></div></pre>
<p>Effectively changing <code>R0</code> from</p>
<blockquote>
<p><code>0000 0000 0000 0000 0000 0000 0000 1111</code></p>
</blockquote>
<p>To:</p>
<blockquote>
<p><code>1111 1111 1111 1111 1111 1111 1111 1111</code></p>
</blockquote>
<p>(Preserving the -1)</p>
<h3><code>ASRS</code> Arithmetic Shift Right</h3>
<p>The <code>ASRS</code> instruction is like the <code>LSRS</code> (logical shift right) instruction, however instead of always injecting a 0 on the left, it injects the same bit as the most significant bit. This means that if the number is signed it preserves the negative. <strong>Effectively this instruction divides by powers of 2 while preserving the sign.</strong></p>
<hr>
<h2>Oct 4, 2018</h2>
<h3>Counting characters in a string</h3>
<p>To count how many times a char occurs in a string:</p>
<p>pseudocode:</p>
<ul>
<li>point character pointer at first char in string</li>
<li>while char isn't null
<ul>
<li>read ASCII of current character</li>
<li>if current character == searched char
<ul>
<li>increment count</li>
</ul>
</li>
<li>increment char pointer</li>
</ul>
</li>
</ul>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_modifier">extern</span> <span class="ace_storage ace_type">int</span> <span class="ace_identifier">charCount</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">char</span> <span class="ace_identifier">s</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">char</span> <span class="ace_identifier">c</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">char</span> <span class="ace_identifier">myString</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">]</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string ace_start">"</span><span class="ace_string">aababac</span><span class="ace_string ace_end">"</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">x</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">main</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">x</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">charCount</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">myString</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_string">'a'</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></pre>
<p>In assembly:</p>
<blockquote>
<p><code>myString</code> will be stored in memory with register <code>R0</code> pointing at it. The character thats being searched for will be stored in <code>R1</code></p>
</blockquote>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    AREA |.text|, CODE, READONLY
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EXPORT charCount
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>charcount
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R2, #0; initalize count
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>nextChar
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDRB R3, [R0]; get character
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    CMP R3,#0; end of string?
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BEQ endloop
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    CMP R3, R1; is char == c?
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BNE nextIteration
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R2, #1; count++
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>nextIteration
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R0, #1; advance pointer
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    B nextChar
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>endloop
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOV R0, R2; put char count in return register
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BX LR
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    END
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<hr>
<h2>Oct 9, 2018</h2>
<h3>Calculating arithmetic mean</h3>
<p>Using a 64 cell array, we can calculate the arithmetic mean of the cells. We are concerned with how fast the mean can be calculated. This will be an array that is passed by some c code.</p>
<p>In <code>statsC.c</code>:</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_modifier">extern</span> <span class="ace_storage ace_type">int</span> <span class="ace_identifier">mean64</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">short</span> <span class="ace_identifier">data</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">])</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">short</span> <span class="ace_identifier">myData</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">64</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">xbar</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">main</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword ace_control">for</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">&lt;</span> <span class="ace_constant ace_numeric">64</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_identifier">i</span><span class="ace_keyword ace_operator">++</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">myData</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">i</span><span class="ace_paren ace_rparen">]</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">8</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">xbar</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">mean64</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">myData</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<p><code>short</code> is a 16 bit data type, so we're working with half words in our registers.</p>
<p>In <code>statsAsm.s</code>:</p>
<blockquote>
<p><code>R0</code> = address of array<br>
<code>R1</code> = sum of array elements<br>
<code>R2</code> = current array element<br>
<code>R3</code> = loop counter</p>
</blockquote>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    AREA |.text|, CODE, READONLY
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EXPORT mean64
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>mean64
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R1, #0;initialize sum
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R3, #64;initialize loop count
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>loop1   LDRH R2, [R0]; get current element
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R1, R1, R2; add element to sum
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R0, #2; advance pointer
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    SUBS R3, #1; loop count - 1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BNE loop1; branch if zero flag is on
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ASRS R1, #6; divide by 64 and preserve sign
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R0, R1; return result in R0
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BX LR
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    END
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<p><strong>You must advance the for loop by 2 because we are working with half words.</strong></p>
<p>Clock cycles:<br>
512 clock cycles in the loop alone. Clock speed of our chip is 48MHz. To figure out the period <span class="MathJax" id="MathJax-Element-1459-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23265" style="width: 1.391em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.239em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.687em, 1000em, 2.91em, -0.396em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-23266"><span class="mn" id="MathJax-Span-23267" style="font-family: STIXGeneral-Regular;">1</span><span class="texatom" id="MathJax-Span-23268"><span class="mrow" id="MathJax-Span-23269"><span class="mo" id="MathJax-Span-23270" style="font-family: STIXGeneral-Regular;">/</span></span></span><span class="mi" id="MathJax-Span-23271" style="font-family: STIXGeneral-Italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.107em; vertical-align: -0.292em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1459">1/f</script>, where <span class="MathJax" id="MathJax-Element-1460-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23272" style="width: 0.516em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.45em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.687em, 1000em, 2.91em, -0.654em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-23273"><span class="mi" id="MathJax-Span-23274" style="font-family: STIXGeneral-Italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.107em; vertical-align: -0.292em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1460">f</script> is the frequency (<span class="MathJax" id="MathJax-Element-1461-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23275" style="width: 4.328em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.885em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.784em, -0.396em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-23276"><span class="mn" id="MathJax-Span-23277" style="font-family: STIXGeneral-Regular;">1</span><span class="texatom" id="MathJax-Span-23278"><span class="mrow" id="MathJax-Span-23279"><span class="mo" id="MathJax-Span-23280" style="font-family: STIXGeneral-Regular;">/</span></span></span><span class="mn" id="MathJax-Span-23281" style="font-family: STIXGeneral-Regular;">48</span><span class="mi" id="MathJax-Span-23282" style="font-family: STIXGeneral-Italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.039em;"></span></span><span class="mi" id="MathJax-Span-23283" style="font-family: STIXGeneral-Italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mi" id="MathJax-Span-23284" style="font-family: STIXGeneral-Italic;">z</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.965em; vertical-align: -0.152em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1461">1/48MHz</script>, ~21 nanoseconds). 519 total clocks * 21 nano seconds = 10,899, ~11 micro seconds.</p>
<hr>
<h2>Oct 11, 2018</h2>
<h3>10,000 foot view (software organization)</h3>
<p>Problems and concerns when creating embedded systems. In real time systems the software has time dependencies.</p>
<ul>
<li>Soft real time
<ul>
<li>Can miss deadlines, doesn't have an extreme consequence (games, game controllers)</li>
</ul>
</li>
<li>Hard real time
<ul>
<li>Cannot miss deadlines, if you miss a deadline whatever you were producing is now invalid. May have severe consequences in the system.</li>
</ul>
</li>
</ul>
<p>Highly reliable software:<br>
Software that you don't want to fail. Usually real-time. (Autopilots, landing gear deployment, jet engine fuel controllers). A special way to write software.</p>
<p>Software organization:</p>
<ul>
<li>Super loop
<ul>
<li>Actions are in a non-stop loop, never ending. (not used in Highly-reliable systems). Used more when timing isn't a concern</li>
</ul>
</li>
<li>Cyclic executive scheduling
<ul>
<li>A lightweight scheduling mechanism</li>
<li>A gold standard for highly reliable systems.</li>
<li>Small scale projects (automotive industry, dashboard control)</li>
<li>No distinct scheduling mechanism, can be handled with interrupts</li>
<li>Used extensively in aerospace, avionics</li>
<li>Most real-time applications do not require
<ul>
<li>general purpose multitasking (or preemption)</li>
<li>disk access</li>
<li>printing</li>
</ul>
</li>
<li>Full blown OS not necessary</li>
<li>Scheduling Frames
<ul>
<li>Major/minor frames provide a way to organize repeating 'processes'</li>
<li>Major frame usually 1 second, but can be any consistent duration</li>
<li>'Process scheduling' is defined by what will be computed during each minor frame</li>
<li>Minor frame rate varies from 4/sec up to 100/sec</li>
<li>Most important tasks occur first in minor frames, and the less important goes toward the end of the minor frame. Each time the timer goes off the task that is still executing will be cut off and switched to the next minor frame.</li>
<li>The tasks are usually controlled by a <code>switch</code> statement.</li>
<li>Frames are usually left with some head room after the tasks, to allow for other interrupts to occur (from a data port for example)</li>
<li>Sum of subprogram execution times cannot exceed minor frame time limit.</li>
</ul>
</li>
<li>Pros
<ul>
<li>Great for periodic systems</li>
<li>intuitively obvious</li>
<li>HRT processes not preemptive
<ul>
<li>no shared data problem</li>
</ul>
</li>
<li>Lightweight, low overhead scheduler</li>
<li>Proven technique</li>
</ul>
</li>
<li>Cons
<ul>
<li>Difficult to load balance</li>
<li>Processes rates limited by minor frame</li>
<li>Time consuming processes must be split into shorter pieces</li>
<li>Fragile: may break if you add a process, remove a process, or chance process order</li>
<li>Difficult to incorporate sporadic process</li>
</ul>
</li>
</ul>
</li>
<li>Real-time OS
<ul>
<li>A highly reliable operating system used in real-time systems (however cyclic executive are used more so). (Wind River OS, for example). Allows us to create tasks (functions), and the OS will execute the tasks in turn. (Pre-emptive operating system). The system has a timer that periodically goes off, and the OS will use a context switch (save registers to memory), and go to the next task (and load its registers). One task can supercede another task in a pre-emptive system.</li>
<li>If a shared variable is being used with multiple tasks, if a task gets pre-empted, the variable might not be fully updated.</li>
<li>If the code is interrupted in the middle of a task, the instruction is completed and a 'bookmark' is left in the task.</li>
<li>Instead of turning interrupts off and on after the variable is used, you can use a semafor, a 'flag' that says that the variable is in use in another task and must be completed before it can be used, so the task will pre-empt itself.</li>
</ul>
</li>
</ul>
<hr>
<h2>Oct 16, 2018</h2>
<h3>LEDs and Switches</h3>
<p><strong>Switches</strong></p>
<table>
<thead>
<tr>
<th>Digital</th>
<th>Voltage</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0 volts (ground)</td>
</tr>
<tr>
<td>1</td>
<td>3.3VDC</td>
</tr>
</tbody>
</table>
<p>EMF = electro-motive force (voltage), think of as a pressure.</p>
<p><strong>LEDs (light emitting diode)</strong></p>
<p>Diodes let power go one way, consists of anode (+) and cathode (-).</p>
<p>Ohms Law:</p>
<blockquote>
<p><span class="MathJax" id="MathJax-Element-1462-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23285" style="width: 3.391em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.041em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.431em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-23286"><span class="mi" id="MathJax-Span-23287" style="font-family: STIXGeneral-Italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span class="mo" id="MathJax-Span-23288" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-23289" style="font-family: STIXGeneral-Italic; padding-left: 0.313em;">I<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.051em;"></span></span><span class="mi" id="MathJax-Span-23290" style="font-family: STIXGeneral-Italic;">R</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.87em; vertical-align: -0.082em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1462">V = IR</script></p>
</blockquote>
<p>V is voltage<br>
I is current<br>
R is resistance</p>
<p>Our LEDs use 2ma, so <span class="MathJax" id="MathJax-Element-1463-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23291" style="width: 3.891em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.491em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.714em, -0.515em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-23292"><span class="mi" id="MathJax-Span-23293" style="font-family: STIXGeneral-Italic;">I<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.051em;"></span></span><span class="mo" id="MathJax-Span-23294" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-23295" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">2</span><span class="mi" id="MathJax-Span-23296" style="font-family: STIXGeneral-Italic;">m</span><span class="mi" id="MathJax-Span-23297" style="font-family: STIXGeneral-Italic;">a</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.888em; vertical-align: -0.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1463">I = 2ma</script>. Our system voltage is 3.3v, so <span class="MathJax" id="MathJax-Element-1464-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23298" style="width: 3.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.322em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.721em, -0.431em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-23299"><span class="mi" id="MathJax-Span-23300" style="font-family: STIXGeneral-Italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span class="mo" id="MathJax-Span-23301" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-23302" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">3.3</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.895em; vertical-align: -0.082em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1464">V = 3.3</script>. Our <span class="MathJax" id="MathJax-Element-1465-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23303" style="width: 4.828em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.336em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.681em, 1000em, 2.999em, -0.431em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-23304"><span class="msubsup" id="MathJax-Span-23305"><span style="display: inline-block; position: relative; width: 1.012em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.431em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-23306" style="font-family: STIXGeneral-Italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.655em;"><span class="mi" id="MathJax-Span-23307" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.103em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-23308" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-23309" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">1.6</span><span class="mi" id="MathJax-Span-23310" style="font-family: STIXGeneral-Italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.213em; vertical-align: -0.391em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1465">V_f = 1.6V</script> (forward voltage drop).</p>
<blockquote>
<p><span class="MathJax" id="MathJax-Element-1466-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23311" style="width: 5.203em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.673em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.278em, 1000em, 3.186em, -0.52em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-23312"><span class="mi" id="MathJax-Span-23313" style="font-family: STIXGeneral-Italic;">R</span><span class="mo" id="MathJax-Span-23314" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mfrac" id="MathJax-Span-23315" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 2.485em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(1.678em, 1000em, 2.687em, -0.453em); top: -2.934em; left: 50%; margin-left: -1.182em;"><span class="mrow" id="MathJax-Span-23316"><span class="msubsup" id="MathJax-Span-23317"><span style="display: inline-block; position: relative; width: 1.125em; height: 0px;"><span style="position: absolute; clip: rect(1.678em, 1000em, 2.49em, -0.453em); top: -2.309em; left: 0em;"><span class="mi" id="MathJax-Span-23318" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; top: -2.09em; left: 0.452em;"><span class="texatom" id="MathJax-Span-23319"><span class="mrow" id="MathJax-Span-23320"><span class="mi" id="MathJax-Span-23321" style="font-size: 50%; font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-23322" style="font-size: 50%; font-family: STIXGeneral-Italic;">y</span><span class="mi" id="MathJax-Span-23323" style="font-size: 50%; font-family: STIXGeneral-Italic;">s</span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span></span><span class="mo" id="MathJax-Span-23324" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">−</span><span class="msubsup" id="MathJax-Span-23325"><span style="display: inline-block; position: relative; width: 0.731em; height: 0px;"><span style="position: absolute; clip: rect(1.678em, 1000em, 2.49em, -0.453em); top: -2.309em; left: 0em;"><span class="mi" id="MathJax-Span-23326" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; top: -2.09em; left: 0.452em;"><span class="mi" id="MathJax-Span-23327" style="font-size: 50%; font-family: STIXGeneral-Italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.073em;"></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(3.367em, 1000em, 4.273em, -0.512em); top: -3.62em; left: 50%; margin-left: -0.656em;"><span class="msubsup" id="MathJax-Span-23328"><span style="display: inline-block; position: relative; width: 1.312em; height: 0px;"><span style="position: absolute; clip: rect(1.678em, 1000em, 2.477em, -0.512em); top: -2.309em; left: 0em;"><span class="mi" id="MathJax-Span-23329" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">I<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.036em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; top: -2.09em; left: 0.245em;"><span class="texatom" id="MathJax-Span-23330"><span class="mrow" id="MathJax-Span-23331"><span class="mi" id="MathJax-Span-23332" style="font-size: 50%; font-family: STIXGeneral-Italic;">L<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-23333" style="font-size: 50%; font-family: STIXGeneral-Italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span class="mi" id="MathJax-Span-23334" style="font-size: 50%; font-family: STIXGeneral-Italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(0.831em, 1000em, 1.239em, -0.507em); top: -1.29em; left: 0em;"><span style="border-left-width: 2.485em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0em;"></span><span style="display: inline-block; width: 0px; height: 1.07em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.868em; vertical-align: -0.599em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1466">R = \frac{ V_{sys} - V_f }{ I_{LED} }</script></p>
</blockquote>
<hr>
<h2>Oct 18, 2018</h2>
<h3>Code conversion</h3>
<p>Binary -&gt; ASCII hex</p>
<p>To change the byte <code>0100 0001</code> to ASCII, you'd have to run it through some code conversion software. That way the correct number will be shown instead of the ASCII letter 'A'. A dumb terminal can't differentiate what you want to do with certain information, all it does it show the ASCII codes for the binary patterns it receives. So by converting our original 65 into a 6 and a 5 in binary, it will show correctly.</p>
<p>Some c code to show conversion from a PC to the embedded system and back to PC.</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Serial</span> <span class="ace_identifier">pc</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">USBTX</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">USBRX</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">//tx, rx</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">main</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">pc</span><span class="ace_punctuation ace_operator">.</span><span class="ace_support ace_function ace_C99 ace_c">printf</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">Hello world</span><span class="ace_constant ace_language ace_escape">\b\r</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">pc</span><span class="ace_punctuation ace_operator">.</span><span class="ace_support ace_function ace_C99 ace_c">putc</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">65</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">//putc outputs one character</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">pc</span><span class="ace_punctuation ace_operator">.</span><span class="ace_support ace_function ace_C99 ace_c">printf</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_constant ace_language ace_escape">\n\r</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">//flushes buffer with a carriage return and line feed</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword ace_control">while</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">pc</span><span class="ace_punctuation ace_operator">.</span><span class="ace_support ace_function ace_C99 ace_c">putc</span><span class="ace_paren ace_lparen">(</span> <span class="ace_identifier">pc</span><span class="ace_punctuation ace_operator">.</span><span class="ace_support ace_function ace_C99 ace_c">getc</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">//echo input back to terminal</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></pre>
<table>
<thead>
<tr>
<th>4 bit number</th>
<th>ASCII Hex</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>1010</code>, 0xA</td>
<td><code>0100 0001</code>, 65<span class="MathJax" id="MathJax-Element-1467-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-23335" style="width: 0.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.845em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.699em, 1000em, 2.525em, -0.507em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-23336"><span class="msubsup" id="MathJax-Span-23337"><span style="display: inline-block; position: relative; width: 0.807em; height: 0px;"><span style="position: absolute; clip: rect(3.829em, 1000em, 4.167em, -0.507em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-23338"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -2.159em; left: 0em;"><span class="texatom" id="MathJax-Span-23339"><span class="mrow" id="MathJax-Span-23340"><span class="mn" id="MathJax-Span-23341" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">10</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.667em; vertical-align: -0.24em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1467">_{10}</script>, 0x41, 'A'</td>
</tr>
</tbody>
</table>
<p>The best way to convert these numbers into hex is <strong>table lookup</strong>.</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    AREA |.text|, CODE, READONLY
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EXPORT BtoAH
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>BtoAH
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ;R0 will contain 4 bit number to convert to ASCII hex
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ;Output: ASCII hex char
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R1,=ASCIIhexTable; address of table into R1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDRB R0, [R1, R0]; copy char into R0 from table using R0 as the offset
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BX LR
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>ASCIIhexTable
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    DCB "0123456789ABCDEF"; define constant byte
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    END
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<blockquote>
<p><code>BtoAH</code> stands for binary to ASCII hex</p>
</blockquote>
<p>In c:</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_modifier">extern</span> <span class="ace_storage ace_type">char</span> <span class="ace_identifier">BtoAH</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">n</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">// 0 to 15</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">char</span> <span class="ace_identifier">asciiChar</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">main</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">asciiChar</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">BtoAH</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">10</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></pre>
<hr>
<h2>Oct 23, 2018</h2>
<h3>Lab 4: 32-bit Binary to ASCII hex (B32toAH)</h3>
<ul class="task-list">
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox"> <s><em>Complete L4</em></s> [2018-10-23]</li>
</ul>
<p>Continuing from the code conversion above. This can be possible by using our 4 bit code converter, counted loop, and left and right shifts.</p>
<p>In <code>B32toAH.c</code></p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_modifier">extern</span> <span class="ace_storage ace_type">void</span> <span class="ace_identifier">B32toAH</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">n</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">char</span> <span class="ace_identifier">s</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">])</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">char</span> <span class="ace_identifier">buff8</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">9</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">//one extra spot for null terminator on end</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">main</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">B32toAH</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0xABCDEF01</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">buff8</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<p><code>B32toAH</code> returns void, however the second parameter (<code>char s[]</code>) will be the result, we will be modifying it but not returning it technically.</p>
<p>In <code>B32toAHasm.s</code></p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    AREA |.text|, CODE, READONLY
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EXPORT B32toAH
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>B32toAH ; R0 32-bit number to convert ASCII hex, passed by c
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R1 address of string buffer, passed by c
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R2 shift counter and loop count
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R3 preserve original number in R0
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R4 char read from ASCII table
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R5 points to first char in ASCIIhexTab lookup table
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    PUSH {R4, R5};        preserve R4 and R5
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R2, #0;          initialize left shift count and loop count to 0
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R3, R0;          preserve R0 into R3
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDR R5, =ASCIIhexTab; load R5 with address of lookup table
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>while1  LSLS R0, R2;          shift left by shift count
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LSRS R0, #28;         shift most significant byte to least significant byte
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDRB R4, [R5, R0];    load low byte into R4
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    STRB R4, [R1];        store byte from R4 into the location of our string in RAM
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R1, #1;          increment string pointer by 1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R2, #4;          increment shift counter by 4
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R0, R3;          restore original number
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    CMP R2, #32;          shift count != 32
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BNE while1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R5, #00;         temporarily put 00 in R5
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    STRB R1, [R5];        end string with null terminator
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    POP {R4, R5};         restore R4, R5
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BX LR;                return
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>ASCIIhexTab
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    DCB "0123456789ABCDEF"
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    END
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<p>First off we'll want to point at the ASCII hex table, then preserve the original string before we start shifting. <strong>Anything above <code>R3</code> must be preserved when the code returns</strong>, so to preserve the higher registers we'll need to use the stack. You want to preserve the registers in the stack first, and restore them once the subprogram has completed. <code>PUSH</code> and <code>POP</code> can be written using hyphens and/or commas (hyphens go thru from the start to the end), and must use curly braces (i.e. <code>PUSH {R4-R6, R10}</code>). <strong>The stacks grows toward low memory.</strong></p>
<hr>
<h2>Oct 25, 2018</h2>
<h3>More code conversion: ASCII decimal -&gt; binary</h3>
<p>For example if the user enters the number '25' on the keyboard, the ASCII codes for that is technically 0x32 and 0x35, and we want to convert it into 0x00000019 (25 in binary) so we can work on it arithmetically.</p>
<table>
<thead>
<tr>
<th>ASCII</th>
<th>Hex</th>
</tr>
</thead>
<tbody>
<tr>
<td>'2'</td>
<td>0x32</td>
</tr>
<tr>
<td>'5'</td>
<td>0x35</td>
</tr>
</tbody>
</table>
<p>If we <strong>minus 0x30 from the ASCII code</strong>, we will end up with the value intended in hex, which will then be converted to binary when compiled.</p>
<p>In <code>ADtoB.c</code>:</p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_modifier">extern</span> <span class="ace_storage ace_type">int</span> <span class="ace_identifier">ADtoB</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">char</span> <span class="ace_identifier">s</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">])</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">char</span> <span class="ace_identifier">input</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">]</span><span class="ace_keyword ace_operator">=</span><span class="ace_string ace_start">"</span><span class="ace_string">25</span><span class="ace_string ace_end">"</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">x</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">main</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">x</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">ADtoB</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">input</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<p>In <code>ADtoBasm.s</code></p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    AREA |.text|, CODE, READONLY
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EXPORT ADtoB
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>ADtoB   ; R0 address of string
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R1 current char being evaluated
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R2 running total, initialized to 0
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R3 holds 10 to be used with multiply instruction
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R2, #0; total = 0
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R3, #10; multiplier = 10
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>nextChar
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDRB R1, [R0]; get char from string
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R0, #1; advance char pointer
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    CMP R1, #0; check for null terminator
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BEQ endLoop1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    SUBS R1, #0x30; strip ASCII
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MULS R2, R3, R2; multiply by 10 to move the total digit to the left
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R2, R2, R1; add digit to running total
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    B nextChar
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>endLoop1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOV R0, R2; put total into R0
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BX LR
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    END
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<hr>
<h2>Oct 30, 2018</h2>
<h3>More code conversion: Binary to ASCII Binary</h3>
<p>We want to convert a 32-bit binary value to ASCII binary. We want to take a binary number and print it in binary on the screen. This will be converted into a 33-byte char array (one for null terminator). This will be possible by left shifting then using a <code>ADCS</code> (add with carry), because the carry flag will contain the digit that we shifted out of the register.</p>
<p>In <code>BtoAB.c</code></p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_modifier">extern</span> <span class="ace_storage ace_type">void</span> <span class="ace_identifier">btoab</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">n</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">char</span> <span class="ace_identifier">s</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">])</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">char</span> <span class="ace_identifier">ascbin</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">33</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">//one extra space for null terminator</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">main</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">btoab</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0xFFFF0000</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">ascbin</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></pre>
<p>In <code>BtoABasm.s</code></p>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    AREA |.text|,CODE,READONLY
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EXPORT btoab
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>btoab   ; R0 number to convert
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R1 address of first char of the string
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R2 holds 0x30, char to store
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R3 #0
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R4 loop counter
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    PUSH {R4};      preserve R4
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R3, #0;    0 to add with carry
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R4, #32;   loop counter
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>loop1   MOVS R2,#'0';   reset 0
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LSLS R0, #1;    msb into carry flag
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADCS R2, R3;    add carry to R2
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    STRB R2, [R1];  store ascii digit into str
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R1, #1;    increment pointer
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    SUBS R4, #1;    decrement loop counter
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BNE loop1
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R2, #0
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    STRB R2, [R1];  null terminate string
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    POP {R4};   restore R4
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BX LR;      return
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    END
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<hr>
<h2>Nov 1, 2018</h2>
<h3>Lab 5: Cipher</h3>
<p>This is a subsitution cipher. To make this cipher easier, and not run into making mid-string null terminators, we will make the message the same length each time. 16 byte messages plus 1 byte for the null terminator.</p>
<p>pseudo:</p>
<ul>
<li>initialize variables</li>
<li>loop 16 times
<ul>
<li>get text char</li>
<li>get key char</li>
<li>if key char is null terminator
<ul>
<li>reset key pointer</li>
<li>get key char</li>
</ul>
</li>
<li>increment key pointer</li>
<li>EOR text char and key char</li>
<li>STRB where R0 points</li>
<li>increment text pointer</li>
<li>loop test</li>
</ul>
</li>
</ul>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_modifier">extern</span> <span class="ace_storage ace_type">void</span> <span class="ace_identifier">cipher16</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">char</span> <span class="ace_identifier">text</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">char</span> <span class="ace_identifier">key</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">])</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">char</span> <span class="ace_identifier">str</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">16</span><span class="ace_paren ace_rparen">]</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string ace_start">"</span><span class="ace_string">This is a test!!</span><span class="ace_string ace_end">"</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">main</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">cipher16</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">str</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_string ace_start">"</span><span class="ace_string">Bob123</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">cipher16</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">str</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_string ace_start">"</span><span class="ace_string">Bob123</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<pre><div class="ace-dawn"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    AREA |.text|, CODE, READONLY
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EXPORT cipher16
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>cipher16
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R0 address of text
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R1 address of key
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R2 loop counter (16)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R3 preserve key location
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R4 current text char
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ; R5 current key char
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    PUSH {R4-R5};   preserve registers
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R2, #16;   loop counter = 16
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R3, R1;    preserving key location
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>loop1   LDRB R4, [R0];  get text char
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDRB R5, [R1];  get key char
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    CMP R5, #0;     key char == null terminator?
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BNE if1;
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    MOVS R1, R3;    reset key
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    LDRB R5, [R1];  reload key
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>if1     ADDS R1, #1;    increment key
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    EORS R4, R5;    xor operation
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    STRB R4, [R0];  store encrypted char
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ADDS R0, #1;    increment text
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    SUBS R2, #1;    decrement loop counter
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BNE loop1;      check if end of loop
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    POP {R4-R5};    restore registers
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    BX LR;          return
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    END
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></pre>
<h3>Parameter passing</h3>
<p>The first 4 parameters of a function are passed thru R0-R3. <strong>Any parameters after the first 4 get pushed onto the stack</strong>. If a variable is passed as a parameter, it will need to go lookup the location of the variable in memory before moving it into a register. When an expression is passed as a parameter</p>
<hr>
<h2>Nov 6, 2018</h2>
<h3>ALU</h3>
<p>ALU lives inside the CPU, everything else exists to bring data to the ALU.</p>
<p>Digital logic:<br>
<strong>AND gate:</strong><br>
Only true if all inputs are true</p>
<p><img src="/LogicGates/AND.png" alt="AND" title="AND"></p>
<table>
<thead>
<tr>
<th style="text-align:center">a</th>
<th style="text-align:center">b</th>
<th style="text-align:center">a <code>&amp;&amp;</code> b</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
<p><strong>OR gate (inclusive):</strong><br>
True if either input is true. This gate can be made with 3 NANDS.</p>
<p><img src="/LogicGates/OR.png" alt="OR" title="OR"></p>
<table>
<thead>
<tr>
<th style="text-align:center">a</th>
<th style="text-align:center">b</th>
<th style="text-align:center">a <code>||</code> b</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
<p><strong>NOT gate:</strong><br>
Returns the opposite of the input. Also known as a inverter</p>
<p><img src="/LogicGates/NOT.png" alt="NOT" title="NOT"></p>
<table>
<thead>
<tr>
<th style="text-align:center">a</th>
<th style="text-align:center"><code>!</code>a</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
</tbody>
</table>
<p><strong>NAND gate:</strong><br>
NOT AND, returns opposite of a AND gate. <strong>One of two universal gates</strong>. Uses the least resistors. If you tie the two inputs together it turns into a NOT gate (however the propagation delay is slower then a NOT).</p>
<p><img src="/LogicGates/NAND.png" alt="NAND" title="NAND"></p>
<table>
<thead>
<tr>
<th style="text-align:center">a</th>
<th style="text-align:center">b</th>
<th style="text-align:center">a AND b NOT</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
</tbody>
</table>
<p><strong>NOR gate:</strong><br>
NOT OR gate. <strong>One of the two universal gates</strong>. Was the first integrated circuit to be mass produced (Fairchild organization, second silicon valley company, 1961).</p>
<p><img src="/LogicGates/NOR.png" alt="NOR" title="NOR"></p>
<table>
<thead>
<tr>
<th style="text-align:center">a</th>
<th style="text-align:center">b</th>
<th style="text-align:center">a OR b NOT</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
</tbody>
</table>
<hr>
<h2>Nov 13, 2018</h2>
<h3>The Assembler</h3>
<p>Used to translate our .s files to generate .o files. Object code files are not directly executed, they are prepared to be fed into the linker. The linker hooks all the .o files together and creates the core image (actual executable code). Inside the assembler there are 2 critical things we need to look at. The symbol table (label table), and the location counter. There is also a pass counter. The assembler "drinks the characters through a straw", character by character. Lexical analysis. It checks each instruction in it's table and keeps track of the next instruction will be. On the first pass its checking how much room each instruction takes up. The assembler also checks if anything is in column zero ( a label ) and it adds it to the symbol table, and it keeps track of it's address. On the second pass of the assembler it actually makes the machine code for each instruction. It doesn't check labels on the second pass. It looks up each symbol in the symbol table, to look ahead in the code.</p>
<p>mbed &gt; hardware boards &gt; st microsystems boards &gt; NUCLEO L432KC &gt; Technical references document &gt; Reference manual (RM0394)</p>
<p>STM32L432KC</p>
</div></div>
      <script>document.body.onkeyup = function(e) {
if (e.keyCode === 39) window.location.href = 'CS46-lecture-notes.html';
if (e.keyCode === 37) window.location.href = 'CS26-reading-notes.html';
}</script>
    </body>
    </html>
  